(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{446:function(e,t,a){e.exports=a(782)},451:function(e,t,a){},782:function(e,t,a){"use strict";a.r(t);var n,r=a(0),c=a.n(r),o=a(45),l=a.n(o),i=(a(451),a(72)),s=a.n(i),u=a(123),m=a(359),d=a(360),f=a(411),E=a(361),p=a(412),b=a(808),h=a(795),g=a(806),w=a(809),v=a(799),k=a(807),y=a(230),j=a(410),x=a(161),P=a(413),O=a(805),T=a(811),S=a(801),N=a(387),_=a(388),C=a(389),A=a(390),D=a(803),I=a(802),q=a(804),J=a(471),R=a(226),L=a.n(R),U=function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r,c,o,l,i,u,m;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.title.split("."),n=t.title,r=a[1],console.log("Preparing the upload",n,r),e.next=6,L.a.post("/api/s3_sign",{fileName:n,fileType:r});case 6:if(c=e.sent){e.next=9;break}return e.abrupt("return",null);case 9:return console.log(c),o=c.data.data.returnData,l=o.signedRequest,i=o.url,console.log("Recieved a signed request "+l),u={headers:{"Content-Type":r},onUploadProgress:function(e){console.log(e.loaded)}},e.next=17,L.a.put(l,t.rawFile,u);case 17:if(m=e.sent,console.log("Response from s3",m),!m){e.next=21;break}return e.abrupt("return",i);case 21:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),$=function(e){var t=e.filename,a=localStorage.getItem("token");L.a.post("/api/s3_delete",{fileName:t},{headers:{authorization:"".concat(a)}})},H=a(59),z=a(13),B=(n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.a.fetchJson,a=function(e){var t=e.pagination,a=t.page,n=t.perPage,r=e.sort,c=r.field,o=r.order;return c&&(e.filter.$sort=("DESC"===o?"-":"")+c),null!=e.filter.q&&(e.filter.$term=e.filter.q,delete e.filter.q),Object.assign(J.a.flattenObject(e.filter),{$limit:n,$page:a},c?{$sort:("DESC"===o?"-":"")+("id"===c?"_id":c)}:{})},n=function(e){var t=Object.assign({},e.data);return delete t.id,delete t.createdAt,delete t.updatedAt,delete t.deletedAt,delete t.isDeleted,JSON.stringify(t)};return function(r,c,o){if(r===z.i)return Promise.all(o.ids.map(function(a){return t("".concat(e,"/").concat(c,"/").concat(a),{method:"PATCH",body:JSON.stringify(o.data)})})).then(function(e){return{data:e.map(function(e){return e.json})}});if(r===z.c)return Promise.all(o.ids.map(function(a){return t("".concat(e,"/").concat(c,"/").concat(a),{method:"DELETE"})})).then(function(e){return{data:e.map(function(e){return e.json})}});var l=function(t,r,c){var o="",l={};switch(t){case z.d:var i=a(c);o="".concat(e,"/").concat(r,"?").concat(Object(H.stringify)(i));break;case z.g:o="".concat(e,"/").concat(r,"/").concat(c.id);break;case z.f:var s=a(c);s[c.target]=c.id,o="".concat(e,"/").concat(r,"?").concat(Object(H.stringify)(s));break;case z.h:o="".concat(e,"/").concat(r,"/").concat(c.id),l.method="PUT",l.body=n(c);break;case z.a:o="".concat(e,"/").concat(r),l.method="POST",l.body=n(c);break;case z.b:o="".concat(e,"/").concat(r,"/").concat(c.id),l.method="DELETE";break;case z.e:o="".concat(e,"/").concat(r,"?").concat(c.ids.map(function(e){return Object(H.stringify)({_id:e})}).join("&"));break;default:throw new Error("Unsupported fetch action type ".concat(t))}return{url:o,options:l}}(r,c,o),i=l.url,s=l.options;return t(i,s).then(function(e){return function(e,t,a,n){console.log(t,a,n);var r=e.json;switch(t){case z.d:case z.e:case z.f:return{data:r.docs.map(function(e){return(e.id=e._id)&&delete e._id&&e}),total:r.items.total};case z.a:return n.data.id=n.data._id,delete n.data._id,{data:n.data};case z.b:return{data:n};default:return r?(r.id=r._id,delete r._id,{data:r}):{data:{}}}}(e,r,c,o)})}}("/api",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.headers||(t.headers=new Headers({Accept:"application/json"}));var a=localStorage.getItem("token");return t.headers.set("authorization","".concat(a)),J.a.fetchJson(e,t)}),function(){var e=Object(u.a)(s.a.mark(function e(t,a,r){var c,o,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t,a,r),"CREATE"!==t||"file"!==a){e.next=20;break}c=null,o=0;case 4:if(!(o<r.data.files.length)){e.next=19;break}return e.next=7,U(r.data.files[o]);case 7:if(!e.sent){e.next=15;break}return e.next=11,n(t,a,{data:{filename:r.data.files[o].title,path:r.data.files[o].title}});case 11:c=e.sent,console.log(c),e.next=16;break;case 15:throw new Error("upload error");case 16:o++,e.next=4;break;case 19:return e.abrupt("return",c);case 20:if("DELETE"!==t||"file"!==a){e.next=26;break}return e.next=23,n("GET_ONE","file",{id:r.id});case 23:(l=e.sent)&&l.data&&$(l.data),console.log("now dispatching normal delete request to api");case 26:return e.abrupt("return",n(t,a,r));case 27:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}()),W=a(195),F=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/api",G=function(e,t){if(e===W.d){var a=t.username,n=t.password,r=new Request(F+"/login",{method:"POST",body:JSON.stringify({username:a,password:n}),headers:new Headers({"Content-Type":"application/json"})});return fetch(r).then(function(e){if(e.status<200||e.status>=300)throw new Error(e.statusText);return e.json()}).then(function(e){var t=e.token;localStorage.setItem("token",t)})}if(e===W.e)return localStorage.removeItem("token"),Promise.resolve();if(e===W.b){var c=t.status;return 401===c||403===c?(localStorage.removeItem("token"),Promise.reject()):Promise.resolve()}return e===W.a?(console.log("auth check",localStorage.getItem("token")),localStorage.getItem("token")?Promise.resolve():Promise.reject()):Promise.reject("Unknown method")},M=c.a.createElement(b.a,null,c.a.createElement(h.a,{source:"username"}),c.a.createElement(h.a,{source:"password"})),K=function(e){return c.a.createElement(g.a,e,M)},Q=function(e){return c.a.createElement(w.a,e,M)},V=c.a.createElement(b.a,null,c.a.createElement(h.a,{source:"key"}),c.a.createElement(v.a,{source:"type",choices:[{id:"text",name:"Text"},{id:"number",name:"Number"}]}),c.a.createElement(h.a,{source:"value"})),X=function(e){return c.a.createElement(g.a,e,V)},Y=function(e){return c.a.createElement(w.a,e,V)},Z=c.a.createElement(b.a,null,c.a.createElement(h.a,{source:"name"}),c.a.createElement(k.a,{label:"board",source:"board",reference:"board",perPage:200},c.a.createElement(v.a,{optionText:"name"})),c.a.createElement(h.a,{multiline:!0,source:"script"})),ee=function(e){return c.a.createElement(g.a,e,Z)},te=function(e){return c.a.createElement(w.a,e,Z)},ae=function(e){return c.a.createElement(y.b,e,c.a.createElement(j.a,{rowClick:"edit"},c.a.createElement(x.a,{source:"name"})))},ne=c.a.createElement(b.a,null),re=function(e){return c.a.createElement(g.a,e,ne)},ce=function(e){return c.a.createElement(w.a,e,ne)},oe=c.a.createElement(b.a,null,c.a.createElement(h.a,{source:"key"}),c.a.createElement(h.a,{source:"value"}),c.a.createElement(v.a,{source:"varScope",choices:[{id:"player",name:"player"},{id:"playerNode",name:"playerNode"},{id:"node",name:"node"},{id:"board",name:"board"}]}),c.a.createElement(k.a,{label:"player",source:"player",reference:"player",perPage:200,allowEmpty:!0},c.a.createElement(v.a,{optionText:"id"})),c.a.createElement(k.a,{label:"node",source:"script",reference:"scriptNode",perPage:200,allowEmpty:!0},c.a.createElement(v.a,{optionText:"name"})),c.a.createElement(k.a,{label:"board",source:"board",reference:"board",perPage:200,allowEmpty:!0},c.a.createElement(v.a,{optionText:"name"}))),le=function(e){return c.a.createElement(g.a,e,oe)},ie=function(e){return c.a.createElement(w.a,e,oe)},se=function(e){return c.a.createElement(P.a,e,c.a.createElement(O.a,{undoable:!1,record:e.data}))},ue=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(f.a)(this,Object(E.a)(t).call(this,e))).state={baseURL:""},console.log(e),a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,a,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="",e.next=3,fetch("/api/config?key=fileServerURL");case 3:return a=e.sent,e.next=6,a.json();case 6:return(n=e.sent).docs.length&&(t=n.docs[0].value),e.next=10,fetch("/api/file/"+this.props.id);case 10:return a=e.sent,e.next=13,a.json();case 13:n=e.sent,console.log(n),n&&this.setState({url:t+n.filename});case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return c.a.createElement(g.a,this.props,c.a.createElement(b.a,{toolbar:c.a.createElement(se,null)},c.a.createElement(x.a,{source:"filename"}),c.a.createElement("a",{href:this.state.url},"link")))}}]),t}(r.Component),me=function(e){return c.a.createElement(w.a,e,c.a.createElement(b.a,null,c.a.createElement(T.a,{source:"files",multiple:!0},c.a.createElement(S.a,{source:"filename",title:"title"}))))},de=c.a.createElement(b.a,null,c.a.createElement(h.a,{source:"message"}),c.a.createElement(h.a,{source:"label"}),c.a.createElement(h.a,{source:"attachment"}),c.a.createElement(h.a,{source:"sender"}),c.a.createElement(h.a,{source:"recipients"}),c.a.createElement(h.a,{source:"board"}),c.a.createElement(h.a,{source:"node"}),c.a.createElement(h.a,{source:"timestamp"}),c.a.createElement(h.a,{source:"seen"})),fe=function(e){return c.a.createElement(g.a,e,de)},Ee=function(e){return c.a.createElement(w.a,e,de)},pe=c.a.createElement(b.a,null,c.a.createElement(h.a,{source:"name"}),c.a.createElement(h.a,{source:"description"}),c.a.createElement(h.a,{source:"project"})),be=function(e){return c.a.createElement(g.a,e,pe)},he=function(e){return c.a.createElement(y.b,Object.assign({},e,{perPage:100}),c.a.createElement(j.a,{rowClick:"edit"},c.a.createElement(x.a,{source:"recipients"}),c.a.createElement(x.a,{source:"seen"}),c.a.createElement(x.a,{source:"message"}),c.a.createElement(x.a,{source:"sender"}),c.a.createElement(x.a,{source:"label"}),c.a.createElement(x.a,{source:"node"}),c.a.createElement(x.a,{source:"board"}),c.a.createElement(N.a,{source:"timestamp"}),c.a.createElement(N.a,{source:"createdAt"}),c.a.createElement(x.a,{source:"id"}),c.a.createElement(N.a,{source:"updatedAt"})))},ge=(c.a.createElement(b.a,null),function(e){return c.a.createElement(y.b,Object.assign({},e,{perPage:100}),c.a.createElement(j.a,{rowClick:"edit"},c.a.createElement(x.a,{source:"id"}),c.a.createElement(x.a,{source:"name"}),c.a.createElement(_.a,{source:"users"},c.a.createElement(C.a,null,c.a.createElement(A.a,{source:"username"})))))}),we=function(){return c.a.createElement(D.a,{dataProvider:B,authProvider:G},c.a.createElement(I.a,{name:"config",list:q.a,edit:X,create:Y}),c.a.createElement(I.a,{name:"board",list:q.a,edit:be}),c.a.createElement(I.a,{name:"scriptNode",list:ae,edit:ee,create:te}),c.a.createElement(I.a,{name:"player",list:q.a,edit:re,create:ce}),c.a.createElement(I.a,{name:"variable",list:q.a,edit:le,create:ie}),c.a.createElement(I.a,{name:"file",list:q.a,edit:ue,create:me}),c.a.createElement(I.a,{name:"message",list:he,edit:fe,create:Ee}),c.a.createElement(I.a,{name:"nodeLog",list:q.a}),c.a.createElement(I.a,{name:"project",list:ge}),c.a.createElement(I.a,{name:"item",list:q.a}),c.a.createElement(I.a,{name:"user",list:q.a,edit:K,create:Q}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(c.a.createElement(we,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[446,1,2]]]);
//# sourceMappingURL=main.416c733b.chunk.js.map